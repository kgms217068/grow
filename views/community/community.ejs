<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>커뮤니티</title>

   <!-- ✅ Font Awesome CDN 활성화 -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

   <!-- ✅ 외부 스타일시트 연결 -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/community.css">

  <style>
    /* 여기에서 간단한 CSS 바로 삽입해도 OK */
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
    }
  </style>
</head>
<body>
  <div class="community-wrapper"
     style="width: 430px; min-height: 100vh; margin: 0 auto; background: #fff; padding: 20px; box-sizing: border-box; position: relative;">
    
    <!-- 검색창 -->
    <form action="/community" method="get" style="display: flex; justify-content: center; margin-bottom: 20px;">
      <div style="position: relative; width: 100%;">
        <input type="text" name="search" placeholder="검색"
               style="width: 100%; height: 44px; padding: 0 44px 0 15px; border-radius: 22px; border: 1px solid #000; font-size: 16px; outline: none;">
        <button type="submit"
                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 18px; cursor: pointer;">
              <!-- 검색 아이콘 Font Awesome으로 변경 -->
              <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </div>
    </form>

    <!-- 게시글 목록 -->
    <ul class="post-list" style="list-style: none; padding: 0; margin: 0;">
      <% posts.forEach(post => { %>
        <li style="position: relative; width: 90%; margin: 20px auto; padding: 15px 10px; border-bottom: 1px solid #ccc;">
          <!-- 우측 상단 시간 -->
          <div style="position: absolute; top: 15px; right: 10px; font-size: 12px; color: #666;">
            <%= post.timeAgo %>
          </div>

          <!-- 게시글 제목 및 내용 -->
          <a href="/community/detail/<%= post.post_id %>" style="text-decoration: none; color: black;">
            <div style="display: flex; align-items: flex-start; gap: 10px;">
              <!-- 프로필 아이콘 -->
                <div class="user-avatar" style="position: relative;">
                  <i class="fa-solid fa-user-circle user-icon"></i>
                  <% if (post.badge === 'gold') { %>
                      <img src="/img/gold.png" class="badge-img" />
                  <% } else if (post.badge === 'silver') { %>
                      <img src="/img/silver.png" class="badge-img" />
                  <% } %>
                </div>

<!-- 제목 + 내용 묶음 -->
<div style="flex-grow: 1; overflow: hidden;">
  <!-- 제목: 시간 영역 침범 방지 -->
  <div style="
    font-weight: bold;
    font-size: 15px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px; /* 추가: 시간 침범 방지 */
  ">
    <%= post.title %>
  </div>

  <!-- 내용은 줄바꿈 가능하게 두 줄 표시도 가능 -->
  <div style="
    font-size: 14px;
    color: #444;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  ">
    <%= post.content %>
  </div>
</div>

            </div>
          </a>

          <!-- 아이콘 정보 -->
          <div style="margin-top: 10px; font-size: 16px;">
 <!-- 좋아요 -->
<% if (post.likedByUser) { %>
  <i class="fa-solid fa-heart" style="color: red;"></i> <%= post.likeCount %> &nbsp;&nbsp;
<% } else { %>
  <i class="fa-regular fa-heart"></i> <%= post.likeCount %> &nbsp;&nbsp;
<% } %>

<!-- 댓글 -->
<i class="fa-regular fa-comment"></i> <%= post.commentCount %> &nbsp;&nbsp;

<!-- 스크랩 -->
<% if (post.scrappedByUser) { %>
  <i class="fa-solid fa-star" style="color: #ffee00;"></i> <%= post.scrapCount %>
<% } else { %>
  <i class="fa-regular fa-star"></i> <%= post.scrapCount %>
<% } %>

        </div>
      </li>
    <% }) %>
    </ul>

<!-- ✅ 하단 네비게이션에 안 가리도록 공간 확보 -->
<div class="bottom-spacer"></div>

    <!-- 작성 버튼 -->
    <div style="position: fixed; bottom: 90px; right: 20px;">
      <a href="/community/post" class="write-button">
        <!-- ✅ 글쓰기 아이콘 Font Awesome으로 변경 -->
        <i class="fa-solid fa-pen"></i>
      </a>
    </div>
  </div>
  <!-- ✅ 하단 고정 네비게이션 -->
<div class="bottom-nav">
  <ul>
    <li>
      <a href="/market">
        <i class="fa-solid fa-gift"></i>
        <div>그로우마켓</div>
      </a>
    </li>
    <li>
      <a href="/home">
        <i class="fa-solid fa-house"></i>
        <div>홈</div>
      </a>
    </li>
    <li>
      <a href="/community">
        <i class="fa-solid fa-users"></i>
        <div>커뮤니티</div>
      </a>
    </li>
    <li>
      <a href="/mypage">
        <i class="fa-solid fa-user"></i>
        <div>마이페이지</div>
      </a>
    </li>
  </ul>
</div>

</body>
</html>

<script>
  window.addEventListener('pageshow', function (event) {
    if (event.persisted) {
      // 뒤로가기로 왔을 때 캐시된 페이지라면 새로고침
      window.location.reload();
    }
  });
</script>