<!--ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° í˜ì´ì§€-->
<!--
<div class="container">
  <h2>ê²Œì‹œê¸€ ì‘ì„± í™”ë©´</h2>
  <form action="/community" method="POST">
    <input type="text" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
    <textarea name="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
    <button type="submit">ì‘ì„±</button>
  </form>
</div>
-->

<!-- community_detail.ejs -->

<div class="container">
  <input type="hidden" id="post-id" value="<%= post.post_id %>">
  <h3><%= post.title %></h3>
  <p><%= post.content %></p>
  <p>
    â¤ï¸ <span id="like-count"><%= post.likeCount %></span>
    <button id="like-button">ì¢‹ì•„ìš”</button>
    ğŸ“ <span id="scrap-count"><%= post.scrapCount %></span>
    <button id="scrap-button">ìŠ¤í¬ë©</button>
  </p>
  <hr>
  <ul class="comments" id="comment-list">
    <% comments.forEach((comment, index) => { %>
      <li id="comment-<%= index %>">
        <strong><%= comment.nickname %>:</strong> <%= comment.comment_content %>
      </li>
    <% }) %>
  </ul>
  <form id="comment-form">
    <input type="text" id="comment-content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”">
    <button type="submit">ì‘ì„±</button>
  </form>
</div>

<script>
document.querySelector('#like-button').addEventListener('click', () => {
  const postId = document.querySelector('#post-id').value;
  fetch(`/community/like/${postId}`, { method: 'POST' })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        const count = document.querySelector('#like-count');
        count.textContent = parseInt(count.textContent) + 1;
      }
    });
});

document.querySelector('#scrap-button').addEventListener('click', () => {
  const postId = document.querySelector('#post-id').value;
  fetch(`/community/scrap/${postId}`, { method: 'POST' })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        const count = document.querySelector('#scrap-count');
        count.textContent = parseInt(count.textContent) + 1;
      }
    });
});

document.querySelector('#comment-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const postId = document.querySelector('#post-id').value;
  const content = document.querySelector('#comment-content').value;

  fetch(`/community/detail/${postId}/comment`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ content })
  })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        const commentList = document.querySelector('#comment-list');
        const newComment = document.createElement('li');
        newComment.innerHTML = `<strong>${data.nickname}:</strong> ${data.content}`;
        commentList.appendChild(newComment);
        document.querySelector('#comment-content').value = '';
      }
    });
});
</script>

<!--ê³ ì³ì•¼ í•˜ëŠ” ë¶€ë¶„: ì´ëª¨í‹°ì½˜ ë‘ ë²ˆ ëˆŒë €ì„ ë•Œ ì·¨ì†Œë˜ë„ë¡ í•˜ê¸°-->