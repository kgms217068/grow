<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>게시글 상세</title>

  <!-- Font Awesome CDN -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

 <!-- ✅ 외부 스타일시트 연결 -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/community.css">
</head>
<body>
  <div class="container">
    <input type="hidden" id="post-id" value="<%= post.post_id %>">

    <!-- 게시글 카드 -->
    <div class="post-card">
      <div class="post-header">
        <div class="post-user-info">
          <div class="user-avatar" style="position: relative;">
            <i class="fa-solid fa-user-circle user-icon"></i>
            <% if (post.badge === 'gold') { %>
              <img src="/img/gold.png" class="badge-img" />
            <% } else if (post.badge === 'silver') { %>
              <img src="/img/silver.png" class="badge-img" />
            <% } %>
          </div>
          <div>
            <strong><%= post.nickname %></strong><br>
            <small><%= new Date(post.createdAt).toLocaleString('ko-KR') %></small>
          </div>
        </div>
        <% if (userId === post.user_id) { %>
          <small class="post-delete" id="delete-post">게시글 삭제</small> 
        <% } %>
      </div>

      <h3 class="post-title"><%= post.title %></h3>
      <p class="post-content"><%= post.content %></p>

      <!-- 반응 바 -->
      <div class="reaction-bar">
        <!-- 좋아요 -->
        <span id="like-icon" style="cursor:pointer;">
          <% if (likedByUser) { %>
            <i class="fa-solid fa-heart" style="color:red;"></i>
          <% } else { %>
            <i class="fa-regular fa-heart"></i>
          <% } %>
        </span>
        <span id="like-count"><%= post.likeCount %></span>

        <!-- 댓글 -->
        <i class="fa-regular fa-comment"></i><span id="comment-count"><%= comments.length %></span>

        <!-- 스크랩 -->
        <span id="scrap-icon" style="cursor:pointer;">
          <% if (scrappedByUser) { %>
            <i class="fa-solid fa-star" style="color: #FFEE00;"></i>
          <% } else { %>
            <i class="fa-regular fa-star"></i>
          <% } %>
        </span>
        <span id="scrap-count"><%= post.scrapCount %></span>
      </div>
    </div>

<!-- 댓글 목록 -->
<ul class="comments" id="comment-list">
  <% comments.forEach(comment => { %>
    <li class="comment-item" id="comment-<%= comment.comment_id %>">
      <div class="comment-header">
  <div class="comment-user-info">
    <div class="user-avatar small" style="position: relative;">
                <i class="fa-solid fa-user-circle user-icon"></i>
                <% if (comment.badge === 'gold') { %>
      <img src="/img/gold.png" class="badge-img" />
    <% } else if (comment.badge === 'silver') { %>
      <img src="/img/silver.png" class="badge-img" />
    <% } %>
    </div>
    <div>
      <strong><%= comment.nickname %></strong><br>
      <small style="font-size: 12px; color: #888;"><%= comment.timeAgo %></small> <!-- ✅ 항상 표시 -->
    </div>
  </div>
  
  <% if (comment.user_id === userId) { %>
    <small class="comment-delete" data-comment-id="<%= comment.comment_id %>">댓글삭제</small> <!-- ✅ 작성자일 때만 표시 -->
  <% } %>
</div>


      <p class="comment-content"><%= comment.comment_content %></p>

      <div class="reaction-bar right" data-comment-id="<%= comment.comment_id %>">
        <span class="comment-like-icon" style="cursor:pointer;">
          <% if (comment.is_liked) { %>
            <i class="fa-solid fa-heart" style="color:red;"></i>
          <% } else { %>
            <i class="fa-regular fa-heart"></i>
          <% } %>
        </span>
        <span class="comment-like-count"><%= comment.like_count %></span>
      </div>
    </li>
  <% }) %>
</ul>

<!-- ✅ 댓글 입력창과 하단 바에 가려지지 않도록 공간 확보 -->
<div style="height: 120px;"></div> <!-- 이 div는 CSS class 없이 직접 지정하면 충돌 없음 -->

<!-- 댓글 입력창 -->
<form id="comment-form" style="display: flex; margin-top: 20px;">
  <input type="text" id="comment-content" placeholder="댓글을 작성하세요" style="flex: 1; padding: 8px; font-size: 14px;" />
  <button type="submit" style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 0 10px;">
    <i class="fa-solid fa-pen"></i>
  </button>
</form>

<!-- 상태 전달 -->
<script>
  window.initialPostState = {
    postId: "<%= post.post_id %>",
    liked: <%- JSON.stringify(likedByUser || false) %>,
    scrapped: <%- JSON.stringify(scrappedByUser || false) %>
  };
</script>


<!-- ✅ 하단 고정 네비게이션 -->
<div class="bottom-nav">
  <ul>
    <li>
      <a href="/market">
        <i class="fa-solid fa-gift"></i>
        <div>그로우마켓</div>
      </a>
    </li>
    <li>
      <a href="/home">
        <i class="fa-solid fa-house"></i>
        <div>홈</div>
      </a>
    </li>
    <li>
      <a href="/community">
        <i class="fa-solid fa-users"></i>
        <div>커뮤니티</div>
      </a>
    </li>
    <li>
      <a href="/mypage">
        <i class="fa-solid fa-user"></i>
        <div>마이페이지</div>
      </a>
    </li>
  </ul>
</div>
<!-- 연결된 프론트 JS 파일 -->
<script src="/js/community_detail.js"></script>
</body>
</html>