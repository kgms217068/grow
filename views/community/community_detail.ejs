<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>게시글 상세</title>

  <!-- Font Awesome CDN -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

 <!-- ✅ 외부 스타일시트 연결 -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/community.css">
</head>
<body>
  <div class="container">
    <input type="hidden" id="post-id" value="<%= post.post_id %>">

    <!-- 게시글 카드 -->
    <div class="post-card">
      <div class="post-header">
        <div class="post-user-info">
          <div class="user-avatar"></div>
          <div>
            <strong><%= post.nickname %></strong><br>
            <small><%= new Date(post.createdAt).toLocaleString('ko-KR') %></small>
          </div>
        </div>
        <% if (userId === post.user_id) { %>
          <small class="post-delete" id="delete-post">게시글 삭제</small> 
        <% } %>
      </div>

      <h3 class="post-title"><%= post.title %></h3>
      <p class="post-content"><%= post.content %></p>

      <!-- 반응 바 -->
      <div class="reaction-bar">
        <!-- 좋아요 -->
        <span id="like-icon" style="cursor:pointer;">
          <% if (likedByUser) { %>
            <i class="fa-solid fa-heart" style="color:red;"></i>
          <% } else { %>
            <i class="fa-regular fa-heart"></i>
          <% } %>
        </span>
        <span id="like-count"><%= post.likeCount %></span>

        <!-- 댓글 -->
        <i class="fa-regular fa-comment"></i><span id="comment-count"><%= comments.length %></span>

        <!-- 스크랩 -->
        <span id="scrap-icon" style="cursor:pointer;">
          <% if (scrappedByUser) { %>
            <i class="fa-solid fa-star" style="color: #FFEE00;"></i>
          <% } else { %>
            <i class="fa-regular fa-star"></i>
          <% } %>
        </span>
        <span id="scrap-count"><%= post.scrapCount %></span>
      </div>
    </div>

<!-- 댓글 목록 -->
<ul class="comments" id="comment-list">
  <% comments.forEach(comment => { %>
    <li class="comment-item" id="comment-<%= comment.comment_id %>">
      <div class="comment-header">
        <div class="comment-user-info">
          <div class="user-avatar small"></div>
          <strong><%= comment.nickname %></strong>
        </div>
        <% if (comment.user_id === userId) { %>
          <small class="comment-delete" data-comment-id="<%= comment.comment_id %>">댓글삭제</small>
        <% } else { %>
          <small><%= new Date(comment.created_at).toLocaleString('ko-KR') %></small>
        <% } %>
      </div>

      <p class="comment-content"><%= comment.comment_content %></p>

      <!-- ✅ 댓글 좋아요 기능 추가 -->
      <div class="reaction-bar right" data-comment-id="<%= comment.comment_id %>">
        <span class="comment-like-icon" style="cursor:pointer;">
          <% if (comment.is_liked) { %>
            <i class="fa-solid fa-heart" style="color:red;"></i>
          <% } else { %>
            <i class="fa-regular fa-heart"></i>
          <% } %>
        </span>
        <span class="comment-like-count"><%= comment.like_count %></span>
      </div>
    </li>
  <% }) %>
</ul>

    <!-- 댓글 입력창 -->
    <form id="comment-form" style="display: flex; margin-top: 20px;">
      <input type="text" id="comment-content" placeholder="댓글을 작성하세요" style="flex: 1; padding: 8px; font-size: 14px;" />
      <button type="submit" style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 0 10px;">
        <i class="fa-solid fa-pen"></i>
      </button>
    </form>
  </div>

<!-- 상태 전달 -->
<script>
  window.initialPostState = {
    postId: "<%= post.post_id %>",
    liked: <%- JSON.stringify(likedByUser || false) %>,
    scrapped: <%- JSON.stringify(scrappedByUser || false) %>
  };
</script>

<!-- 연결된 프론트 JS 파일 -->
<script src="/js/community_detail.js"></script>
</body>
</html>